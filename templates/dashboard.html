<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Static files with cache busting -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dashboard-style.css') }}?v={{ time }}">
    
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h3>Admin Dashboard</h3>
        <a href="#data-bank">Data Bank</a>
        <a href="#generate-report">Generate Report and Invoice</a>
        <a href="#invoice">Invoice</a>
    </div>

    <!-- Main content area -->
    <div class="content">
        <div id="welcome">
            <h2>Welcome to Admin Dashboard</h2>
            <p>Use the sidebar to navigate between different functionalities.</p>
        </div>

        <!-- Data Bank Section (Previously Add Data Bank) -->
        <div id="data-bank" class="section" style="display: none;">
            <h2>Data Bank</h2>
            <form id="bank-form" method="POST" action="/add_bank">
                <div class="mb-3">
                    <label for="bankCode" class="form-label">Bank Code</label>
                    <input type="text" class="form-control" id="bankCode" name="bank_code" required>
                </div>
                <div class="mb-3">
                    <label for="bankName" class="form-label">Bank Name</label>
                    <input type="text" class="form-control" id="bankName" name="bank_name" required>
                </div>
                <div class="mb-3">
                    <label for="version" class="form-label">Version</label>
                    <select class="form-select" id="version" name="version" required>
                        <option value="V1">V1</option>
                        <option value="V2">V2</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Save</button>
            </form>

            <!-- Check if banks exist -->
            {% if banks %}
            <h3>Existing Banks</h3>
            <table class="table table-bordered mt-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Bank Code</th>
                        <th>Bank Name</th>
                        <th>Version</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bank in banks %}
                    <tr>
                        <td>{{ bank[0] }}</td> <!-- ID -->
                        <td>{{ bank[1] }}</td> <!-- Bank Code -->
                        <td>{{ bank[2] }}</td> <!-- Bank Name -->
                        <td>{{ bank[3] }}</td> <!-- Version -->
                        <td>
                            <a href="{{ url_for('edit_bank', bank_id=bank[0]) }}" class="btn btn-sm btn-warning">Update</a>
                            <a href="{{ url_for('delete_bank', bank_id=bank[0]) }}" class="btn btn-sm btn-danger"
                                onclick="return confirm('Are you sure you want to delete this bank?');">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No banks have been added yet.</p>
            {% endif %}
        </div>

        
        

        <!-- Generate Report and Invoice Section -->
        <div id="generate-report" class="section" style="display: none;">
            <h2>Generate Report and Invoice</h2>
            <form id="report-form">
                <div class="mb-3">
                    <label for="reportVersion" class="form-label">Report Version</label>
                    <select class="form-select" id="reportVersion" required>
                        <option value="V1">V1</option>
                        <option value="V2">V2</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="uploadFiles" class="form-label">Upload CSV Files</label>
                    <input type="file" class="form-control" id="uploadFiles" accept=".csv" multiple required>
                </div>
                <button type="submit" class="btn btn-primary">Generate</button>
            </form>
        </div>

        <!-- Invoice Section -->
        <div id="invoice" class="section" style="display: none;">
            <h2>Invoice</h2>
            <form id="invoice-form" method="POST" action="/invoice">
                <!-- Bank Code: Disable input and use selected bank code -->
                <div class="mb-3">
                    <label for="bankCode" class="form-label">Bank Code</label>
                    {% if banks %}
                    <input type="text" class="form-control" id="bankCode" name="bank_code" 
                        value="{{ banks[0][1] }}" readonly disabled>
                    {% else %}
                    <input type="text" class="form-control" id="bankCode" name="bank_code" 
                        value="No banks available" readonly disabled>
                    {% endif %}
                </div>

                <!-- Bank Name: Dropdown from bank_data -->
                <div class="mb-3">
                    <label for="bankName" class="form-label">Bank Name</label>
                    <select class="form-select" id="bankName" name="bank_name" required>
                        {% for bank in banks %}
                            <option value="{{ bank[1] }}">{{ bank[2] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- Other fields in the form remain the same -->
                <div class="mb-3">
                    <label for="tieringName" class="form-label">Tiering Name</label>
                    <input type="text" class="form-control" id="tieringName" name="tiering_name" required>
                </div>
                <div class="mb-3">
                    <label for="trxMinimum" class="form-label">Minimum Transaksi</label>
                    <input type="number" class="form-control" id="trxMinimum" name="trx_minimum" required>
                </div>
                <div class="mb-3">
                    <label for="trxFinance" class="form-label">Jumlah Transaksi Finansial</label>
                    <input type="number" class="form-control" id="trxFinance" name="trx_finance" required>
                </div>
                <div class="mb-3">
                    <label for="financePrice" class="form-label">Harga Finansial</label>
                    <input type="number" class="form-control" id="financePrice" name="finance_price" required>
                </div>
                <div class="mb-3">
                    <label for="trxNonfinance" class="form-label">Jumlah Transaksi Non-Finansial</label>
                    <input type="number" class="form-control" id="trxNonfinance" name="trx_nonfinance" required>
                </div>
                <div class="mb-3">
                    <label for="nonfinancePrice" class="form-label">Harga Non-Finansial</label>
                    <input type="number" class="form-control" id="nonfinancePrice" name="nonfinance_price" required>
                </div>
                <button type="submit" class="btn btn-primary">Save</button>
            </form>
        </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Get the section to be shown from Flask (if passed)
        const showSection = "{{ show_section }}";
    
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
                document.querySelector(link.getAttribute('href')).style.display = 'block';
            });
        });
    
        // If 'show_section' is provided by Flask, show that section by default
        if (showSection) {
            document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
            document.getElementById(showSection).style.display = 'block';
        }
        document.getElementById('bankName').addEventListener('change', function () {
            // Get the selected bank's index
            const selectedBankIndex = this.selectedIndex;
    
            // Get the corresponding bank code from the banks list (passed from Flask)
            const bankCodeInput = document.getElementById('bankCode');
            const bankCodes = {{ banks | tojson }};
            
            // Set the bank code field based on the selected bank
            bankCodeInput.value = bankCodes[selectedBankIndex][1];  // Assuming bank[1] is the code
        });
    </script>
    
</body>

</html>
