<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekap Transaksi Invoice Bulanan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Static files with cache busting -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dashboard-style.css') }}?v={{ time }}">
    <!-- Include upload-style.css for consistent styling -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/generate-report-style.css') }}?v={{ time }}">

</head>


<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h3>Admin Dashboard</h3>
        <a href="#data-bank">Data Bank</a>
        <a href="#generate-report">Generate Report and Invoice</a>
        <a href="#invoice">Invoice</a>
    </div>

    <!-- Main content area -->
    <div class="content">
        <!-- Welcome Section -->
        <div id="welcome">
            <h2>Welcome to Admin Dashboard</h2>
            <p>Use the sidebar to navigate all the feature.</p>
        </div>

        <!-- Data Bank Section -->
        <div id="data-bank" class="section" style="display: none;">
            <h2>Data Bank</h2>
            <form id="bank-form" method="POST" action="/add_bank">
                <div class="mb-3">
                    <label for="bankCode" class="form-label">Bank Code</label>
                    <input type="text" class="form-control" id="bankCode" name="bank_code" required>
                </div>
                <div class="mb-3">
                    <label for="bankName" class="form-label">Bank Name</label>
                    <input type="text" class="form-control" id="bankName" name="bank_name" required>
                </div>
                <div class="mb-3">
                    <label for="version" class="form-label">Version</label>
                    <select class="form-select" id="version" name="version" required>
                        <option value="V1">V1</option>
                        <option value="V2">V2</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Save</button>
            </form>
            <br>
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="alert-container">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Check if banks exist -->
            {% if banks %}
            <h3>Data Bank</h3>
            <table class="table table-bordered mt-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Bank Code</th>
                        <th>Bank Name</th>
                        <th>Version</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bank in banks %}
                    <tr>
                        <td>{{ bank[0] }}</td>
                        <td>{{ bank[1] }}</td>
                        <td>{{ bank[2] }}</td>
                        <td>{{ bank[3] }}</td>
                        <td>
                            <a href="{{ url_for('edit_bank', bank_id=bank[0]) }}" class="btn btn-sm btn-warning">Update</a>
                            <a href="{{ url_for('delete_bank', bank_id=bank[0]) }}" class="btn btn-sm btn-danger"
                                onclick="return confirm('Are you sure you want to delete this bank?');">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No banks have been added yet.</p>
            {% endif %}
        </div>

        <!-- Generate Report and Invoice Section -->
        <div id="generate-report" class="section" style="display: none;">
            <h2>Generate Report and Invoice</h2>
            <form id="report-form" method="POST" action="/upload" enctype="multipart/form-data" onsubmit="return validateForm()">
                <div class="mb-3">
                    <label for="reportVersion" class="form-label">Report Version</label>
                    <select class="form-select" id="reportVersion" name="reportVersion" required>
                        <option value="select-the-option">Select Version</option> <!-- Default invalid option -->
                        <option value="V1">V1</option>
                        <option value="V2">V2</option>
                    </select>
                </div>

                <!-- Drag-and-Drop Zone for File Upload -->
                <div class="mb-3">
                    <label for="uploadFiles" class="form-label">Upload CSV Files</label>
                    <div id="drop-zone" class="drop-zone">
                        <span class="drop-zone__prompt">Drag & drop your files here or click to select files</span>
                        <input type="file" class="drop-zone__input" id="uploadFiles" name="files" accept=".csv" multiple>
                    </div>
                </div>

                <!-- Display the uploaded file names -->
                <div id="file-names" class="mt-2"></div> <!-- This div will display the file names -->

                <button type="submit" class="btn btn-primary">Upload</button>
            </form>
        </div>

        

        <!-- Invoice Section -->
        <div id="invoice" class="section" style="display: none;">
            <h2>Invoice</h2>
            <form id="invoice-form" method="POST" action="/data_invoice">
                <!-- Bank Name: Dropdown from bank_data -->
                <div class="mb-3">
                    <label for="bankName" class="form-label">Bank Name</label>
                    <select class="form-select" id="bankName" name="bank_id" required>
                        {% for bank in banks %}
                            <option value="{{ bank[0] }}">{{ bank[2] }}</option> <!-- bank[0]: ID, bank[2]: Bank Name -->
                        {% endfor %}
                    </select>
                </div>


                <div class="mb-3">
                    <label for="tieringName" class="form-label">Tiering Name</label>
                    <input type="text" class="form-control" id="tieringName" name="tiering_name" required>
                </div>
                <div class="mb-3">
                    <label for="trxMinimum" class="form-label">Minimum Transaksi</label>
                    <input type="number" class="form-control" id="trxMinimum" name="trx_minimum" required>
                </div>
                <div class="mb-3">
                    <label for="trxFinance" class="form-label">Jumlah Transaksi Finansial</label>
                    <input type="number" class="form-control" id="trxFinance" name="trx_finance" required>
                </div>
                <div class="mb-3">
                    <label for="financePrice" class="form-label">Harga Finansial</label>
                    <input type="number" class="form-control" id="financePrice" name="finance_price" required>
                </div>
                <div class="mb-3">
                    <label for="trxNonfinance" class="form-label">Jumlah Transaksi Non-Finansial</label>
                    <input type="number" class="form-control" id="trxNonfinance" name="trx_nonfinance" required>
                </div>
                <div class="mb-3">
                    <label for="nonfinancePrice" class="form-label">Harga Non-Finansial</label>
                    <input type="number" class="form-control" id="nonfinancePrice" name="nonfinance_price" required>
                </div>
                <button type="submit" class="btn btn-primary">Save</button>
            </form>
            <br>
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="alert-container">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Display the saved invoices -->
            {% if invoices %}
            <h3>Data Invoice</h3>
            <table class="table table-bordered mt-4">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Bank Code</th> <!-- Add this column -->
                        <th>Bank Name</th>
                        <th>Tiering Name</th>
                        <th>Minimum Transaksi</th>
                        <th>Jumlah Transaksi Finansial</th>
                        <th>Harga Finansial</th>
                        <th>Jumlah Transaksi Non-Finansial</th>
                        <th>Harga Non-Finansial</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in invoices %}
                    <tr>
                        <td>{{ invoice[0] }}</td>
                        <td>{{ invoice[1] }}</td> <!-- bank_code is at index 1 -->
                        <td>{{ invoice[2] }}</td> <!-- bank_name is at index 2 -->
                        <td>{{ invoice[3] }}</td>
                        <td>{{ invoice[4] }}</td>
                        <td>{{ invoice[5] }}</td>
                        <td>{{ invoice[6] }}</td>
                        <td>{{ invoice[7] }}</td>
                        <td>{{ invoice[8] }}</td>
                        <td>
                            <a href="{{ url_for('edit_invoice', invoice_id=invoice[0]) }}" class="btn btn-sm btn-warning">Edit</a>
                            <form method="POST" action="{{ url_for('delete_invoice', invoice_id=invoice[0]) }}" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this invoice?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No invoices have been added yet.</p>
            {% endif %}




    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard-script.js') }}"></script>
    <!-- JavaScript for section navigation and dynamic form updates -->
    <script>
        // Get the section to be shown from Flask (if passed)
        const showSection = "{{ show_section }}";
    
        document.querySelectorAll('.sidebar a').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
                document.querySelector(link.getAttribute('href')).style.display = 'block';
            });
        });
    
        // Show the section passed from Flask if available
        if (showSection) {
            document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
            document.getElementById(showSection).style.display = 'block';
        }

        // Update Bank Code based on selected Bank Name
        document.getElementById('bankName').addEventListener('change', function () {
            const selectedBankIndex = this.selectedIndex;
            const bankCodes = {{ banks | tojson }};
            // If needed, update other related fields here based on the bank selection
        });
    </script>
    
</body>

</html>
